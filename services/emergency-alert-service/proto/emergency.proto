syntax = "proto3";

package emergency;

// Service principal de gestion des alertes d'urgence
service EmergencyAlertService {
  // Créer une nouvelle alerte
  rpc CreateAlert(AlertRequest) returns (AlertResponse);
  
  // Récupérer les alertes actives par zone
  rpc GetActiveAlerts(ZoneRequest) returns (AlertListResponse);
  
  // Mettre à jour le statut d'une alerte
  rpc UpdateAlertStatus(UpdateStatusRequest) returns (AlertResponse);
  
  // Consulter l'historique des alertes
  rpc GetAlertHistory(HistoryRequest) returns (AlertHistoryResponse);
  
  // S'abonner aux alertes en temps réel (streaming)
  rpc SubscribeAlerts(SubscribeRequest) returns (stream AlertResponse);
}

// Types d'urgence
enum AlertType {
  ALERT_TYPE_UNSPECIFIED = 0;
  ACCIDENT = 1;
  FIRE = 2;
  AMBULANCE_REQUEST = 3;
  MEDICAL_EMERGENCY = 4;
  NATURAL_DISASTER = 5;
  SECURITY_THREAT = 6;
  PUBLIC_HEALTH = 7;
}

// Statut de l'alerte
enum AlertStatus {
  ALERT_STATUS_UNSPECIFIED = 0;
  PENDING = 1;
  IN_PROGRESS = 2;
  RESOLVED = 3;
  CANCELLED = 4;
}

// Niveau de priorité
enum Priority {
  PRIORITY_UNSPECIFIED = 0;
  LOW = 1;
  MEDIUM = 2;
  HIGH = 3;
  CRITICAL = 4;
}

// Localisation géographique
message Location {
  double latitude = 1;
  double longitude = 2;
  string address = 3;
  string city = 4;
  string zone = 5; // Zone administrative (ex: "Zone Nord")
}

// Requête pour créer une alerte
message AlertRequest {
  AlertType type = 1;
  string description = 2;
  Location location = 3;
  Priority priority = 4;
  string reporter_name = 5;
  string reporter_phone = 6;
  int32 affected_people = 7; // Nombre de personnes affectées
}

// Réponse avec les détails de l'alerte
message AlertResponse {
  string alert_id = 1;
  AlertType type = 2;
  string description = 3;
  Location location = 4;
  Priority priority = 5;
  AlertStatus status = 6;
  string reporter_name = 7;
  string reporter_phone = 8;
  int32 affected_people = 9;
  int64 created_at = 10; // Timestamp Unix
  int64 updated_at = 11; // Timestamp Unix
  string assigned_team = 12;
}

// Requête pour filtrer par zone
message ZoneRequest {
  string zone = 1;
  AlertType type = 2; // Optionnel: filtrer par type
  Priority min_priority = 3; // Optionnel: priorité minimale
}

// Liste d'alertes
message AlertListResponse {
  repeated AlertResponse alerts = 1;
  int32 total_count = 2;
}

// Requête pour mettre à jour le statut
message UpdateStatusRequest {
  string alert_id = 1;
  AlertStatus new_status = 2;
  string assigned_team = 3; // Équipe assignée
  string notes = 4; // Notes sur l'intervention
}

// Requête pour l'historique
message HistoryRequest {
  string zone = 1; // Optionnel
  AlertType type = 2; // Optionnel
  int64 start_date = 3; // Timestamp Unix
  int64 end_date = 4; // Timestamp Unix
  int32 limit = 5; // Nombre max de résultats
}

// Réponse avec l'historique
message AlertHistoryResponse {
  repeated AlertResponse alerts = 1;
  int32 total_count = 2;
  map<string, int32> statistics = 3; // Stats par type/statut
}

// Requête pour s'abonner aux alertes
message SubscribeRequest {
  repeated string zones = 1; // Zones d'intérêt
  repeated AlertType types = 2; // Types d'alertes
  Priority min_priority = 3; // Priorité minimale
}